/**
 * curly-bracket-parser
 *
 * Simple parser to replace variables inside templates/strings and files
 *
 * @version 0.0.1
 * @date 2021-01-10T23:49:01.679Z
 * @link https://github.com/magynhard/curly-bracket-parser
 * @author Matthäus J. N. Beyrle
 * @copyright Matthäus J. N. Beyrle
 */
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}}();function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var CurlyBracketParser=function(){function y(){_classCallCheck(this,y)}return _createClass(y,null,[{key:"parse",value:function(e,r,t){var n=1<arguments.length&&void 0!==r?r:{},i=y,a=(a=2<arguments.length&&void 0!==t?t:{unresolved_vars:"throw",replace_pattern:"##$1##"})||{};a=Object.assign({unresolved_vars:"throw",replace_pattern:"##$1##"},a),n=n||{};var o=e;if(i.isAnyVariableIncluded(e)){for(;;){var l=!0,s=!1,u=void 0;try{for(var c=i.variables(e)[Symbol.iterator]();!(l=(_=c.next()).done);l=!0){var f=_.value,d=i.decodeVariable(f),v=d.name,_=d.filter,d=null;n[v]?(d=_?i.processFilter(_,n[v]):n[v],o=i._replaceAll(o,f,d)):i.isRegisteredDefaultVar(v)&&(d=i.processDefaultVar(v),o=i._replaceAll(o,f,d))}}catch(e){s=!0,u=e}finally{try{!l&&c.return&&c.return()}finally{if(s)throw u}}if(!i.isAnyVariableIncluded(o)||!i.includesOneVariableOf(Object.keys(n),o))break}switch(a.unresolved_vars){case"throw":if(i.isAnyVariableIncluded(o))throw new UnresolvedVariablesError("There are unresolved variables in the given string: "+i.variables(o));break;case"replace":o=o.replace(i.VARIABLE_DECODER_REGEX,a.replace_pattern)}}return o}},{key:"parseFile",value:function(e,r,t){var n=1<arguments.length&&void 0!==r?r:{},i=y,a=(a=2<arguments.length&&void 0!==t?t:{unresolved_vars:"throw",replace_pattern:"##$1##",success:null,write:!1})||{};if(a=Object.assign({unresolved_vars:"throw",replace_pattern:"##$1##",success:null,write:!1},a),n=n||{},i._runByNode()){var o=require("fs"),l=o.readFileSync(e,"utf-8").toString(),l=i.parse(l,n,a);return a.write&&o.writeFileSync(e,l),l}if(i._runByBrowser()){var s="Could not retrieve file '"+e+"' by GET.";if(a.success&&"function"==typeof a.success){var u=new XMLHttpRequest;return u.open("GET",e,!0),u.onload=function(e){if(4!==u.readyState)throw new FileNotRetrievedError(s);if(200!==u.status)throw new FileNotRetrievedError(s+"\n"+u.statusText);var r=i.parse(u.responseText,n,a);a.success(r)},u.send(null),null}l=new XMLHttpRequest;if(l.open("GET",e,!1),l.send(null),200===l.status)return i.parse(l.responseText,n,a);throw new FileNotRetrievedError(s+"\n"+l.statusText)}}},{key:"parseFileWrite",value:function(e,r,t){var n=1<arguments.length&&void 0!==r?r:{},i=2<arguments.length&&void 0!==t?t:{unresolved_vars:"throw",replace_pattern:"##$1##"},a=y;if((i=i||{}).write=!0,a._runByNode())return a.parseFile(e,n,i);throw"This method can only be run on node js, not in browser."}},{key:"_runByNode",value:function(){return"undefined"!=typeof module&&module.exports}},{key:"_runByBrowser",value:function(){return!y._runByNode()}},{key:"registerFilter",value:function(e,r,t){var n=y;if(n.isValidFilter(e))throw new FilterAlreadyRegisteredError("The given filter name '"+e+"' is already registered");if("function"!=typeof r)throw"Given parameter 'filter_function' must be of type 'function'. It is of type '"+(void 0===r?"undefined":_typeof(r))+"'.";n.registered_filters[e]=r}},{key:"processFilter",value:function(e,r){var t=y;if(t.registered_filters[e])return t.registered_filters[e](r);if("undefined"!=typeof LuckyCase&&t.VALID_DEFAULT_FILTERS().includes(LuckyCase.toUpperCase(e))&&LuckyCase.isValidCaseType(LuckyCase.toUpperCase(e)))return LuckyCase.convertCase(r,LuckyCase.toUpperCase(e));t="Invalid filter '"+e+"'. Valid filters are: "+t.validFilters().join(" ");throw new InvalidFilterError(t)}},{key:"validFilters",value:function(){var e=y,r=e.VALID_DEFAULT_FILTERS(),t=Object.keys(e.registered_filters),e=e.VALID_DEFAULT_FILTERS().map(function(e){return e.toLocaleLowerCase()});return r.concat(t).concat(e)}},{key:"isValidFilter",value:function(e){return y.validFilters().includes(e)}},{key:"registerDefaultVar",value:function(e,r,t){var n=y,i=(i=2<arguments.length&&void 0!==t?t:{overwrite:!1})||{};if(i=Object.assign({unresolved_vars:"throw",replace_pattern:"##$1##"},i),n.isRegisteredDefaultVar(e)&&!1===i.overwrite)throw new VariableAlreadyRegisteredError("The given variable name '"+e+"' is already registered. If you want to override that variable explicitly, use option 'overwrite: true'!");if("function"==typeof r)return n.registered_default_vars[e]=r;throw"Given parameter 'var_function' must be of type 'function'. It is of type '"+(void 0===r?"undefined":_typeof(r))+"'."}},{key:"processDefaultVar",value:function(e){var r=y;if(r.registered_default_vars[e])return r.registered_default_vars[e]();r="Invalid default variable '"+e+"'. Valid registered default variables are: "+Object.keys(r.registered_default_vars).join(" ");throw new InvalidVariableError(r)}},{key:"unregisterDefaultVar",value:function(e){return!!y.registered_default_vars[e]&&(delete y.registered_default_vars[e],!0)}},{key:"registeredDefaultVars",value:function(){return Object.keys(y.registered_default_vars)}},{key:"isRegisteredDefaultVar",value:function(e){return y.registeredDefaultVars().includes(e)}},{key:"decodeVariable",value:function(e){return y.decodedVariables(e)[0]}},{key:"decodedVariables",value:function(e){var r=y,t=[];for(r.VARIABLE_DECODER_REGEX.lastIndex=0;;){var n=r.VARIABLE_DECODER_REGEX.exec(e);if(!n){r.VARIABLE_DECODER_REGEX.lastIndex=0;break}n={name:n[1].trim(),filter:""!==n[2].trim()?n[2].trim():null};t.push(n)}return t}},{key:"variables",value:function(e){return e.match(y.VARIABLE_REGEX).flat()}},{key:"isAnyVariableIncluded",value:function(e){return null!==e.match(y.VARIABLE_REGEX)}},{key:"includesOneVariableOf",value:function(e,r){var t=y,n=!0,i=!1,a=void 0;try{for(var o=t.decodedVariables(r)[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var l=l.value;if(e.includes(l.name))return!0}}catch(e){i=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}return!1}},{key:"_replaceAll",value:function(e,r,t){return e.split(r).join(t)}}]),y}();CurlyBracketParser.registered_filters={},CurlyBracketParser.registered_default_vars={},CurlyBracketParser.VARIABLE_DECODER_REGEX=/{{([^{}\|]+)\|?([^{}\|]*)}}/gms,CurlyBracketParser.VARIABLE_REGEX=/{{[^{}]+}}/gms,CurlyBracketParser.VALID_DEFAULT_FILTERS=function(){return"undefined"!=typeof LuckyCase?Object.keys(LuckyCase.CASES):[]};var FileNotRetrievedError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="FileNotRetrievedError",e}return _inherits(r,Error),r}(),FilterAlreadyRegisteredError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="FilterAlreadyRegisteredError",e}return _inherits(r,Error),r}(),InvalidFilterError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="InvalidFilterError",e}return _inherits(r,Error),r}(),InvalidVariableError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="InvalidVariableError",e}return _inherits(r,Error),r}(),UnresolvedVariablesError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="UnresolvedVariablesError",e}return _inherits(r,Error),r}(),VariableAlreadyRegisteredError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="VariableAlreadyRegisteredError",e}return _inherits(r,Error),r}();