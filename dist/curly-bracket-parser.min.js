/**
 * curly-bracket-parser
 *
 * Simple parser to replace variables inside templates/strings and files
 *
 * @version 1.0.4
 * @date 2022-06-21T14:54:47.777Z
 * @link https://github.com/magynhard/curly-bracket-parser
 * @author Matthäus J. N. Beyrle
 * @copyright Matthäus J. N. Beyrle
 */
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}}();function _possibleConstructorReturn(e,r){if(e)return!r||"object"!=typeof r&&"function"!=typeof r?e:r;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var CurlyBracketParser=function(){function y(){_classCallCheck(this,y)}return _createClass(y,null,[{key:"getVersion",value:function(){return y._version}},{key:"parse",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=y,n=(n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{unresolved_vars:"throw",replace_pattern:"##$1##"})||{},i=(n=Object.assign({unresolved_vars:"throw",replace_pattern:"##$1##"},n),r=r||{},e);if(t.isAnyVariableIncluded(e)){for(;;){var a=!0,o=!1,l=void 0;try{for(var s,u=t.variables(i)[Symbol.iterator]();!(a=(s=u.next()).done);a=!0){var c=s.value,f=t.decodeVariable(c),d=f.name,v=f.filter,_=null;r[d]?(_=v?t.processFilter(v,r[d]):r[d],i=t._replaceAll(i,c,_)):t.isRegisteredDefaultVar(d)&&(_=t.processDefaultVar(d),i=t._replaceAll(i,c,_))}}catch(e){o=!0,l=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw l}}if(!t.isAnyVariableIncluded(i)||!t.includesOneVariableOf(Object.keys(r),i))break}switch(n.unresolved_vars){case"throw":if(t.isAnyVariableIncluded(i))throw new UnresolvedVariablesError("There are unresolved variables in the given string: "+t.variables(i));break;case"replace":i=i.replace(t.VARIABLE_DECODER_REGEX,n.replace_pattern)}}return i}},{key:"parseFile",value:function(e){var r,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=y,i=(i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{unresolved_vars:"throw",replace_pattern:"##$1##",success:null,write:!1})||{};if(i=Object.assign({unresolved_vars:"throw",replace_pattern:"##$1##",success:null,write:!1},i),t=t||{},n._runByNode())return r=(l=require("fs")).readFileSync(e,"utf-8").toString(),r=n.parse(r,t,i),i.write&&l.writeFileSync(e,r),r;if(n._runByBrowser()){var a,o="Could not retrieve file '"+e+"' by GET.";if(i.success&&"function"==typeof i.success)return(a=new XMLHttpRequest).open("GET",e,!0),a.onload=function(e){if(4!==a.readyState)throw new FileNotRetrievedError(o);if(200!==a.status)throw new FileNotRetrievedError(o+"\n"+a.statusText);var r=n.parse(a.responseText,t,i);i.success(r)},a.send(null),null;var l=new XMLHttpRequest;if(l.open("GET",e,!1),l.send(null),200===l.status)return n.parse(l.responseText,t,i);throw new FileNotRetrievedError(o+"\n"+l.statusText)}}},{key:"parseFileWrite",value:function(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{unresolved_vars:"throw",replace_pattern:"##$1##"},n=y;if((t=t||{}).write=!0,n._runByNode())return n.parseFile(e,r,t);throw"This method can only be run on node js, not in browser."}},{key:"_runByNode",value:function(){return"undefined"!=typeof module&&module.exports}},{key:"_runByBrowser",value:function(){return!y._runByNode()}},{key:"registerFilter",value:function(e,r){var t=y;if(t.isValidFilter(e))throw new FilterAlreadyRegisteredError("The given filter name '"+e+"' is already registered");if("function"!=typeof r)throw"Given parameter 'filter_function' must be of type 'function'. It is of type '"+(void 0===r?"undefined":_typeof(r))+"'.";t.registered_filters[e]=r}},{key:"processFilter",value:function(e,r){var t=y;if(t.registered_filters[e])return t.registered_filters[e](r);if("undefined"!=typeof LuckyCase&&t.VALID_DEFAULT_FILTERS().includes(LuckyCase.toUpperCase(e))&&LuckyCase.isValidCaseType(LuckyCase.toUpperCase(e)))return LuckyCase.convertCase(r,LuckyCase.toUpperCase(e));throw r="Invalid filter '"+e+"'. Valid filters are: "+t.validFilters().join(" "),new InvalidFilterError(r)}},{key:"validFilters",value:function(){var e=y,r=e.VALID_DEFAULT_FILTERS(),t=Object.keys(e.registered_filters),e=e.VALID_DEFAULT_FILTERS().map(function(e){return e.toLocaleLowerCase()});return r.concat(t).concat(e)}},{key:"isValidFilter",value:function(e){return y.validFilters().includes(e)}},{key:"registerDefaultVar",value:function(e,r){var t=y,n=(n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{overwrite:!1})||{};if(n=Object.assign({unresolved_vars:"throw",replace_pattern:"##$1##"},n),t.isRegisteredDefaultVar(e)&&!1===n.overwrite)throw new VariableAlreadyRegisteredError("The given variable name '"+e+"' is already registered. If you want to override that variable explicitly, use option 'overwrite: true'!");if("function"==typeof r)return t.registered_default_vars[e]=r;throw"Given parameter 'var_function' must be of type 'function'. It is of type '"+(void 0===r?"undefined":_typeof(r))+"'."}},{key:"processDefaultVar",value:function(e){var r=y;if(r.registered_default_vars[e])return r.registered_default_vars[e]();throw e="Invalid default variable '"+e+"'. Valid registered default variables are: "+Object.keys(r.registered_default_vars).join(" "),new InvalidVariableError(e)}},{key:"unregisterDefaultVar",value:function(e){var r=y;return!!r.registered_default_vars[e]&&(delete r.registered_default_vars[e],!0)}},{key:"registeredDefaultVars",value:function(){return Object.keys(y.registered_default_vars)}},{key:"isRegisteredDefaultVar",value:function(e){return y.registeredDefaultVars().includes(e)}},{key:"decodeVariable",value:function(e){return y.decodedVariables(e)[0]}},{key:"decodedVariables",value:function(e){var r=y,t=[];for(r.VARIABLE_DECODER_REGEX.lastIndex=0;;){var n=r.VARIABLE_DECODER_REGEX.exec(e);if(!n){r.VARIABLE_DECODER_REGEX.lastIndex=0;break}n={name:n[1].trim(),filter:""!==n[2].trim()?n[2].trim():null};t.push(n)}return t}},{key:"variables",value:function(e){return e.match(y.VARIABLE_REGEX).flat()}},{key:"isAnyVariableIncluded",value:function(e){return null!==e.match(y.VARIABLE_REGEX)}},{key:"includesOneVariableOf",value:function(e,r){var t=y,n=!0,i=!1,a=void 0;try{for(var o,l=t.decodedVariables(r)[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var s=o.value;if(e.includes(s.name))return!0}}catch(e){i=!0,a=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw a}}return!1}},{key:"_replaceAll",value:function(e,r,t){return e.split(r).join(t)}}]),y}(),FileNotRetrievedError=(CurlyBracketParser._version="1.0.4",CurlyBracketParser.registered_filters={},CurlyBracketParser.registered_default_vars={},CurlyBracketParser.VARIABLE_DECODER_REGEX=/{{([^{}\|]+)\|?([^{}\|]*)}}/gms,CurlyBracketParser.VARIABLE_REGEX=/{{[^{}]+}}/gms,CurlyBracketParser.VALID_DEFAULT_FILTERS=function(){return"undefined"!=typeof LuckyCase?Object.keys(LuckyCase.CASES):[]},function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="FileNotRetrievedError",e}return _inherits(r,Error),r}()),FilterAlreadyRegisteredError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="FilterAlreadyRegisteredError",e}return _inherits(r,Error),r}(),InvalidFilterError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="InvalidFilterError",e}return _inherits(r,Error),r}(),InvalidVariableError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="InvalidVariableError",e}return _inherits(r,Error),r}(),UnresolvedVariablesError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="UnresolvedVariablesError",e}return _inherits(r,Error),r}(),VariableAlreadyRegisteredError=function(){function r(e){_classCallCheck(this,r);e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return e.name="VariableAlreadyRegisteredError",e}return _inherits(r,Error),r}();